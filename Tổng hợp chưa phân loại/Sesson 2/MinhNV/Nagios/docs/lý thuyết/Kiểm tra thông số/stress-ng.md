# Hướng dẫn cách áp đặt High CPU Load và kiểm tra sự bận rộn trên linux khi sử dụng công cụ stress-ngVới tư cách là Quản trị viên hệ thống , bạn có thể muốn kiểm tra và giám sát tình trạng của các hệ thống Linux khi chúng đang chịu áp lực cao. Đây có thể là một cách hay để các Quản trị viên Hệ thống và Lập trình:- Điều chỉnh các hoạt động trên một hệ thống.- Giám sát các giao diện hạt nhân của hệ điều hành.- Kiểm tra các thành phần phần cứng Linux của bạn như CPU, bộ nhớ, thiết bị đĩa và nhiều thứ khác để quan sát hiệu suất của chúng trong điều kiện căng thẳng.- Đo điện năng tiêu thụ khác nhau tải trên một hệ thống.	Trong hướng dẫn này, chúng ta sẽ xem xét hai công cụ quan trọng, stress và stress-ng để kiểm tra khối lượng công việc xử lý trong các hệ thống Linux của bạn.	- stress: là một công cụ tạo khối lượng công việc được thiết kế để hệ thống của bạn có thể đo được CPU, bộ nhớ, I / O và ổ cứng.- stress-ng: là một phiên bản cập nhật của công cụ tạo khối lượng công việc lớn để khiểm tra sự bận rộn của hệ thống có nhiều chức năng hơn		- CPU compute	- drive stress	- I/O syncs	- Pipe I/O	- cache thrashing	- VM stress	- socket stressing	- process creation and termination	- context switching propertiesDù những công cụ này rất hữu ích cho việc kiểm tra hệ thống, tuy nhiên nó không nên được sử dụng bởi bất cứ một user hệ thống nào. Tốt hơn hết hãy chỉ cho phép user `root` được dùng để tránh việc hệ thống bị quá tải.## Cách cài đặt công cụ stress trong linux - Cài đặt trên ubuntu ``apt get install stress``- Cài đặt trên Centos ``yum install stress``## Cách tôi sử sụng stress trong linux Câu lệnh chung của stress là:$ sudo stress option argumentSau đây là một số các options có thể dùng với stress:- Để tạo ra N công việc cho hàm sqrt(), dùng -cpu N.- Để tạo ra N công việc cho hàm sync(), dùng -io N.- Để tạo ra N công việc cho hàm malloc()/free(), dùng -vm N.- Để phân bổ bộ nhớ cho mỗi công việc, dùng –vm-bytes N- Thay vì giải phóng và phân bổ lại tài nguyên bộ nhớ, bạn có thể làm lại bộ nhớ bằng cách sử dụng tùy chọn -vm-keep.- Để đặt thời gian sleep là N giây trước khi giải phóng bộ nhớ, dùng –vm-hang N- Để tạo ra N công việc cho hàm write()/unlink(), dùng –hdd N.- Bạn có thể đặt thời gian chờ sau N giây bằng cách sử dụng tùy chọn timeout N.- Để đặt khoảng thời gian đợi trước khi bắt đầu công việc theo microseconds, dùng –backoff N.- Để hiển thị thêm thông tin chi tiết khi chạy stress, hãy sử dụng tùy chọn -v.- Sử dụng -help để xem trợ giúp sử dụng công cụ này.1. Lúc đầu tôi kiểm tra uptime của hệ thông. Chúng ta sẽ ghi lại thông số này để tiện so sánh với kết quả sau khi dùng stressTrên máy này có 1 cpu và giá trị tải trung bình là:```shroot@server:~# uptime 18:31:01 up 1 min,  2 users,  load average: 0.18, 0.08, 0.03```Sau đó tôi sử dụng stress cho giá trị option --cpu là 8 ta thấy kết quả: ```shroot@server:~# stress --cpu 8 --timeout 30sstress: info: [1347] dispatching hogs: 8 cpu, 0 io, 0 vm, 0 hddstress: info: [1347] successful run completed in 30sroot@server:~# uptime 18:37:43 up 8 min,  2 users,  load average: 2.31, 0.64, 0.24```Ở đây, chúng ta đã sinh ra 8 công việc dùng hàm sqrt() tìm căn bậc 2 của 1 số bất kỳ và lấy đến chữ số thập phân cuối cùng nên đòi hỏi cpu phải xử với tải cao.2. Tùy chọn --io 4 tức là ta đã sinh ra 4 quy trình gọi hàm sync(). sync() Chèn bất kỳ dữ liệu nào được lưu trữ trong bộ nhớ vào đĩa.3. Kiểm tra ổ đĩa cứng của bạn bằng cách ghi một tệp lớn vào đĩa:Kích thước tệp mặc định là 1GB và bạn có thể chỉ định bất kỳ kích thước nào với tùy chọn --hdd-bytes , ví dụ như  --hdd-bytes 5G: viết một tệp tin 5 gigabyte.`` stress --hdd 1 --timeout 5m``4. Các tùy chọn --vm-hang mô phỏng điều kiện bộ nhớ thấp bằng cách chó quá trình nặng đi ngủ chứ không phải giải phóng bộ nhớ. Ví dụ này có 3 gigabyte bộ nhớ:``stress --vm 2 --vm-bytes 3G --vm-hang --timeout 60s``5. Tùy chọn --vm 2: là tạo ra 2 quá trình phân bổ và phát hành bộ nhớ (Looping  malloc() và  free()).--vm-bytes 128M : Malloc 128MB per vm worker (default is 256MB)