# Hướng dẫn cài đặt PXE server## Chuẩn bị- Máy Centos7 có 2 card mạng 	+ Dải brigde 192.168.100.0/24 địa chỉ IP là `192.168.100.20` dùng để tải các gói cài đặt	+ Dải hostonly 20.0.0.0/24 địa chỉ IP là 20.0.0.62 dùng để cấp dhcp cho các máy client	+ Môi trường lab nên mình tắt firewall ## Các bước tiến hành cài đặt- Cài đặt các gói sau để thiết lập môi trường PXE``yum install httpd xinetd syslinux tftp-server -y``- Đi tới thư mục `/usr/share/syslinux/` ``cd /usr/share/syslinux/``- Sao chép các tệp cấu hình TFTP sau vào thư mục `/var/lib/tftpboot/```cp pxelinux.0 menu.c32 memdisk mboot.c32 chain.c32 /var/lib/tftpboot/``- Chỉnh sửa file tftp``vi /etc/xinetd.d/tftp``- Thay đổi  “disable=yes” thành “no”.```sh# default: off # description: The tftp server serves files using the trivial file transfer \ #       protocol.  The tftp protocol is often used to boot diskless \ #       workstations, download configuration files to network-aware printers, \ #       and to start the installation process for some operating systems. service tftp { socket_type             = dgram protocol                = udp wait                    = yes user                    = root server                  = /usr/sbin/in.tftpd server_args             = -s /var/lib/tftpboot disable                 = no per_source              = 11 cps                     = 100 2 flags                   = IPv4}```- Copy file iso của OS cần cài và mount vào thư mục /mtn/``mount -o loop /root/CentOS-7-x86_64-Minimal-1611.iso /mnt/``- Tạo đường dẫn `/var/lib/tftpboot/centos7_x64```mkdir /var/lib/tftpboot/centos7_x64``- Thực hiện copy các file cần thiết``cp -fr /mnt/* /var/lib/tftpboot/centos7_x64/``- Cấp quyền cho thư mục ``chmod -R 755 /var/lib/tftpboot/centos7_x64/``- Tạo file kickstart```shcd /var/lib/tftpboot/centos7_x64/vi ks.cfg```- Thêm các dòng khai báo vào thư mục `ks.cfg````shinstallurl --url=http://20.0.0.62/centos7_x64textskipxlang en_US.UTF-8keyboard usnetwork --onboot yes --device eth0 --bootproto dhcp --nameserver 8.8.8.8,8.8.4.4 --hostname ks --noipv6rootpw "minhkma"authconfig --enableshadow --passalgo=sha512# printf "r00tme" | mkpasswd -s -m md5selinux --disabledfirewall --disabledservices --disabled auditd,cups,nfslock,postfixtimezone --utc Asia/Ho_Chi_Minhbootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"zerombrignoredisk --only-use=sdaclearpart --drives=sda --all --initlabelpart /boot --fstype=ext4 --size=200part swap --size=2048part / --fstype=ext4 --size=2048part /home --fstype=ext4 --grow --size=1024repo --name="CentOS"  --baseurl=http://20.0.0.62/centos7_x64poweroff%packages --nobase --ignoremissing --excludedocs@coreopensshvim%end```- Tạo tệp cấu hình apache cho máy chủ PXE trong thư mục `/etc/httpd/conf.d/```vi /etc/httpd/conf.d/pxeboot.conf``- Thêm các dòng sau ```shAlias /centos7_x64 "/var/lib/tftpboot/centos7_x64/"<Directory "/var/lib/tftpboot/centos7_x64">Options Indexes FollowSymLinksRequire all granted</Directory>```- Sửa file ``/var/lib/tftpboot/pxelinux.cfg/default`` để tạo menu boot```shdefault menu.c32prompt 0timeout 300ONTIMEOUT localmenu title ########## PXE Boot Menu ##########label 1menu label ^1) Install CentOS 7kernel centos7_x64/images/pxeboot/vmlinuzappend initrd=centos7_x64/images/pxeboot/initrd.img ks=http://20.0.0.62/centos7_x64/ks.cfg devfs=nomountlabel 2menu label ^2) Boot from local drive localboot```- Cấu hình máy chủ dhcp ``vi /etc/dhcp/dhcpd.conf``-  Thêm các dòng sau ```sh```sh ddns-update-style interim; ignore client-updates; authoritative; allow booting; allow bootp; allow unknown-clients;# A slightly different configuration for an internal subnet. subnet 20.0.0.0 netmask 255.255.255.0 { range 20.0.0.0 20.0.0.40; option domain-name-servers 20.0.0.62; option domain-name "server1.example.com"; default-lease-time 600; max-lease-time 7200; next-server 20.0.0.62; #  DHCP server ip filename "pxelinux.0";}#```- Khởi động lại các dịch vụ```shsystemctl restart xinetdsystemctl restart httpdsystemctl restart dhcpd```- Enable các dịch vụ ```shsystemctl enable xinetdsystemctl enable httpdsystemctl enable dhcpd```- Tắt firewall```shsystemctl disable firewalldsystemctl stop firewalld```- Tắt sellinux```shsed -i 's/\(^SELINUX=\).*/\SELINUX=disabled/' /etc/sysconfig/selinuxsed -i 's/\(^SELINUX=\).*/\SELINUX=disabled/' /etc/selinux/configsetenforce 0```